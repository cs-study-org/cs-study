# Race Condition

## 경쟁상태 정의
공유 자원[^공유자원]에 대해 여러 프로세스가 동시에 접근을 시대할 때, 타이밍이나 순서 등이 결과값에 영향을 줄 수 있는 상태

공유자원에 여러 프로세스가 동시에 접근하면 **자료의 일관성을 해치는 결과**가 나타날 수 있다.


## 경쟁상태가 발생하는 경우

### 커널 코드 실행 중에 인터럽트가 발생할 경우
커널모드에서 데이터를 로드하여 작업을 하던 도중 인터럽트가 발생하여 같은 데이터를 조작하는 경우 발생
**커널이 가진 전역변수는 모든 프로세스의 공유물**이므로 경쟁상태의 가능성이 있다.

> 해결법
커널모드에서 작업을 수행하는 동안 인터럽트를 disable시켜 인터럽트가 CPU제어권을 가져가지 못하도록 하여 해결가능

### 프로세스가 시스템 콜을 하여 커널모드로 진입하여 작업을 수행하는 도중에 문맥교환이 발생할 경우
프로세스1이 커널모드에서 데이터를 조작하던 도중 시간이 초과되어 CPU제어권이 프로세스2로 넘어가 같은 데이터를 조작하는 경우를 말한다.

> 해결법
프로세스가 커널모드에서 작업을 하는 경우에는 시간이 초과되더라도 CPU제어권이 다른 프로세스에게 넘어가지 않도록 한다.

### 멀티 프로세서에서 공유 메모리 내의 커널 데이터에 접근하는 경우
멀티프로세스 환경에서 2개의 CPU가 동시에 커널 내부의 공유데이터에 접근하여 조작하는 경우 발생할 수 있다.

> 해결법
커널 내부에 있는 각 공유 데이터에 접근할 때마다 그 데이터에 대해 lock/unlock함으로써 해결할 수 있다.

### 멀티스레드 환경에서 두개 이상의 스레드가 공통의 전역변수에 접근할 경우
> 해결법
전역변수를 동기화해주어야한다.
java에서는 synchronized키워드를 통해 스레드간 동기화를 하여 thread-sasfe
[synchronized 예제](https://limkydev.tistory.com/64)
예제를 확인하자


## 임계구역
임계 구역은 둘 이상의 스레드가 동시에 접근해서는 안 되는 공유 자원(자료 구조 또는 장치)에 접근하는 코드의 일부를 말한다.

### 임계구역 문제 해결 방법
- 사용자 모드 동기화
  - 피터슨 알고리즘
  - 데커 알고리즘
- 커널모드 동기화
  - 세마포어
  - 뮤텍스
  - 모니터



[^공유자원]:여러 프로세스가 공동으로 이용하는 변수, 메모리, 파일 등을 뜻함


## 참고문헌
[경쟁 상태 참고문헌](https://velog.io/@klloo/%EC%9A%B4%EC%98%81%EC%B2%B4%EC%A0%9C-%EA%B2%BD%EC%9F%81-%EC%83%81%ED%83%9C-Race-Condition)