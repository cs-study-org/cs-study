# LAN 어댑터

- [LAN 어댑터](#lan-어댑터)
  - [들어가며](#들어가며)
  - [패킷의 이동 시나리오](#패킷의-이동-시나리오)
  - [참고 문헌](#참고-문헌)

## 들어가며

TCP의 메시지 송·수신 동작의 다음 동작을 다뤄보겠다.

다음 동작을 수행하는 주체들의 역할을 알아보자.

IP는 

    TCP에서 받은 패킷에 IP 헤더를 부가한다.

    이더넷을 통해 MAC 주소를 조사하여 MAC 헤더를 부가하고, 
    
    LAN 드라이버에 건네준다.

LAN 드라이버는 

    IP에서 송신 패킷을 받고,

    이것을 LAN 어댑터에 건네주어 송신하도록 지시한다.

LAN 어댑터는

    이더넷이 송신 가능한 상태가 되는 것을 보아서

    송신 패킷을 전기 신호로 변환한 후 케이블에 내보낸다.

이더넷은

    장치의 고유 주소를 가지고 장치 간 데이터를 주고 받을 수 있는 방식이다.

    장치 전원에게 ARP(MAC 주소 결정 프로토콜) 패킷을 전달함으로써 장치 간 패킷의 목적지를 판단할 수 있다.

    ARP 캐시로 ARP 패킷의 수를 줄일 수 있다.

각 주체들은 이전 주체들의 동작을 신경쓰지 않는다.

이를 통해 주체들의 하드웨어가 바뀌어도 유연성을 유지할 수 있고, 이는 거대한 네트워크를 구축하는데 도움을 준다.

## 패킷의 이동 시나리오

송신처의 PC에서 수신처의 PC까지 거치는 라우터와 허브를 `패킷 중계 장치`라고 한다.

라우터의 역할은

    IP가 목적지를 확인하여 다음 IP의 라우터를 나타낸다.    

허브의 역할은

    서브넷 안에 있는 이더넷을 통해 라우터까지 패킷을 운반한다

패킷의 이동 시나리오를 [슬라이드](https://slides.com/kimyongki/deck-4cca6f/fullscreen)를 통해 알아보자.

1. 송신처는 목적지인 수신처 IP 주소를 애플리케이션으로 부터 통지받고,
2. 송신처의 IP는 IP 헤더에 수신처 IP 주소를 기록한다.
3. 송신처의 IP는 송신처 IP 주소를 송신처의 LAN 어댑터를 판단하여 설정한다.
4. 목적지가 설정됬으니 운반을 맡기기위해서 이더넷의 송·수신처 구조로 바꿔줘야한다.
5. 송신처의 이더넷은 수신처 방향의 가까운 라우터(R1)를 ARP로 조사한다.
   > 🤔 송신처의 IP가 LAN 어댑터에 의뢰한 뒤, 이더넷을 통해 MAC 주소를 받아오는 것인가? 
   >
   > 받아왔다면 어디에 저장해뒀기 때문에 IP는 MAC 주소를 MAC 헤더에 담을 수 있었던 것인가?
6. 송신처의 IP는 R1의 MAC 주소를 MAC 헤더의 수신처 MAC 주소로 기록한다.
7. 송신처의 IP는 송신처의 LAN 어댑터를 판단하여, LAN 어댑터의 MAC 주소를 MAC 헤더의 송신처 MAC 주소로 기록한다.
8. 패킷을 LAN 어댑터에 건네 
    ...
9.  패킷을 송신하면 같은 서브넷의 허브에 도착한다.
10. 허브의 이더넷 표와 패킷의 MAC 헤더의 수신처 정보를 결합해서 패킷의 목적지를 판단하여 중계한다.
11. 패킷을 송신하여 R1에 도착한다.
12. 라우터의 IP 경로표와 패킷의 IP 헤더의 수신처 정보를 결합하여 패킷을 다음 라우터(R2)로 보낼지 판단하여 중계한다.
13. R2에 할당된 이더넷의 주소를 조사하고, 그 주소를 MAC 헤더에 기입된 정보에 변경시킨다.
14. 이렇게 허브-라우터-허브를 경유해 목적지인 서버에 패킷이 도착한다.

## 참고 문헌

[이더넷의 정의](https://handreamnet.tistory.com/496) ━ *한드림넷 블로그*