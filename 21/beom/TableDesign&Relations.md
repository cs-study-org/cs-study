# 테이블 설계와 릴레이션

## 데이터 모델링

애플리케이션을 만들 때 중요한 것은 `어떤 데이터 항목이 필요한가`를 제대로 파악하는 것이다.

나중에 수정하는 것은 어렵기 때문이다.

> 데이터 모델링이란</br>
> => 필요한 데이터 항목을 나열하고 테이블 설계에 도입해 나가는 작업이다.

## 관계형 데이터베이스 용어

> 데이터(data)
> - 각 항목에 저장되는 값이다.

> 테이블(table or relation)
> - 사전에 정의된 열의 데이터 타입대로 작성된 데이터가 행으로 축적된다.

> 칼럼(column or field)
> - 테이블의 열

> 레코드(record or tuple)
> - 테이블의 행

> 키(key)
> - 테이블의 각 행을 구분할 수 있는 값
> - 기본키(primary key)
>   - 행을 고유하게 식별하기 위한 `식별자`
> - 외래키(foreign key)
>   - 한 테이블의 필드 중 다른 테이블의 행을 식별할 수 있는 키

## 데이터베이스 기능
> 사원 번호가 기본키이고 사원 이름, 부서 이름, 부서 전화번호를 칼럼으로 가지는 테이블이 있다고 생각해보자

**[ 직원테이블 ]**
| 사원 번호(PK) | 사원 이름 | 부서 이름 | 부서 전화번호 |
|---|---|---|---|
| 1 | 신범철 | 인사부 | 02-111-1111 |
| 2 | 김용기 | 인사부 | 02-111-1111 |
| 3 | 김지용 | 경리부 | 02-222-2222 |
| 4 | 황종민 | 인사부 | 02-111-1111 |

> 해당 테이블은 중복 값이 매우 많이 나온다. 그리고 전화번호를 잘못 타이핑해도 그것을 식별하는 것이 어렵다.

### 테이블 관계 기능
중복된 테이블을 없애기 위해서는 중복된 테이블을 **별도의 테이블**에서 관리하는 것이다.

**[ 직원테이블 ]**
| 사원 번호(PK) | 사원 이름 | 부서 이름 |
|---|---|---|
| 1 | 신범철 | 인사부 |
| 2 | 김용기 | 인사부 |
| 3 | 김지용 | 경리부 |
| 4 | 황종민 | 인사부 |

**[ 부서테이블 ]**
| 부서 이름(PK) | 부서 전화번호 |
|---|---|
| 인사부 | 02-111-1111 |
| 경리부 | 02-222-2222 |

이렇게 1:N의 관계성을 맺어 중복을 없애 주었다.
> 관계에는 `1:1 관계`, `1:N 관계`, `N:M 관계`가 있다.

### 기본키는 ID값으로
이건 기능이라기 보단 관계형 디비에서 우리가 기본적으로 정한 것이 맞다.

> ex) 영업 부서 -> 홍보 부서같이 변경 가능성이 있음

기본키는 자주 변경되면 안된다.

기본키는 자주 변경되면 내부 데이터가 심하게 조각을 일으켜 성능이 악화되기 때문에

그래서 ID값으로 설정하여 변경을 최대한 줄여준다.
> ex) 영업 부서(100) -> 홍보 부서(100)이면 둘다 100으로 동일함

**[ 직원테이블 ]**
| 사원 번호(PK) | 사원 이름 | 부서 ID |
|---|---|---|
| 1 | 신범철 | 100 |
| 2 | 김용기 | 100 |
| 3 | 김지용 | 101 |
| 4 | 황종민 | 100 |
| 5 | 이경민 | 200 |

**[ 부서테이블 ]**
| 부서 ID(PK) | 부서 이름 | 부서 전화번호 |
|---|---|---|
| 100 | 인사부 | 02-111-1111 |
| 101 | 회계부 | 02-222-2222 |


### 참조 무결성 제약
참조 무결성 제약은 참조하고 있는 테이블을 검사하여 참조한 곳에 값이 없다면 오류를 반환해주는 것이다.

즉, 위에 직원 테이블에서 200을 작성할시, 부서 테이블에 200이라는 부서 ID는 없기 때문에 오류를 발생하는 것이다.

## 정규화
> 정규화란
> - 관계형 데이터베이스의 설계에서 중복을 최소화하게 데이터를 구조화하는 프로세스를 말한다.


### 제 1정규화
제 1정규화는 `중복 또는 반복, 복합값을 제거`하는 것이다.
다른 말로는 `모든 속성이 도메인 원자값으로 구성되어 있도록 바꾸는 과정`이다.

**[ 직원테이블 ]**
| 사원 번호(PK) | 사원 이름 | 전화번호 |
|---|---|---|
| 1 | 신범철 | 010-1111-1111, 010-2222-2222 |
| 2 | 김용기 | 010-3333-3333 |

지금 테이블은 전화번호가 중복이다.

**[ 직원테이블 ]**
| 사원 번호(PK, FK) | 사원 이름 |
|---|---|
| 1 | 신범철 |
| 2 | 김용기 |

**[ 핸드폰테이블 ]**
| 사원 번호(PK) | 전화번호 |
|---|---|
| 1 | 010-1111-1111 |
| 1 | 010-2222-2222 |
| 2 | 010-3333-3333 |

모든 행들이 원자값으로 변경되었으므로 1정규화를 성공한 것이다.

### 제 2정규화
제 2정규화는 `기본 키가 여러 열로 구성되어 있고 그 중 일부 열의 값을 의해서만 결정되는 것을 없애는 것`이다.</br>
다른 말로는 `부분 함수 종속 제거`라고 한다.

**[ 직원테이블 ]**
| 사원 번호(PK) | 부서 ID(PK) | 부서 이름 | 등록일 |
|---|---|---|---|
| 1 | 100 | 인사부 | 2022-05-24 |
| 2 | 100 | 인사부 | 2022-04-22 |

해당 테이블은 기본키가 두개이다.</br>
(모순이라고 생각함. 기본키는 테이블에서 하나만 존재 가능하기 때문에 후보키 일 것이다.)

`등록일`은 `사원번호`와 `부서 ID`를 둘다 알아야하지만</br>
`부서 이름`은 `부서 ID`만 알아도 된다.

**[ 직원테이블 ]**
| 사원 번호(PK) | 부서 ID(PK) | 등록일 |
|---|---|---|
| 1 | 100 | 2022-05-24 |
| 2 | 100 | 2022-04-22 |

**[ 부서테이블 ]**
| 부서 ID(PK) | 부서 이름 |
|---|---|
| 100 | 인사부 |

### 제 3정규화
제 3정규화는 `테이블의 모든 열은 기본 키 값에 따라 단 하나로 결정되게 하는 것`이다.</br>
다른 말로는 `이행 함수종속 제거`이다.</br>
=> 기본키가 결정되면 나머지 것들이 결정되어야 하지만 기본키가 결정되서 그중의 하나의 값이 결정되는 순간 나머지것들이 그 중 하나의 값 때문에 결정되는 상황

**[ 도서테이블 ]**
| 책 제목 | 가격 | 저자 | 저자 자기소개 | 저자 성별 |
|---|---|---|---|---|
| 노드 교과서 | 10000 | 신범철 | hello | 남자 |
| 쉽게 배우는 운영제체 | 15000 | 신범철 | hello | 남자 |
| 데이터 베이스 | 20000 | 김용기 | bye | 남자 |

책이 결정되는 순간 모든 것이 결정되긴 하지만,

책이 결정되는 순간 저자가 결정되고 저자가 결정되는 순간 저자 자기소개, 저자 성별이 결정된다.

이것을 `이행 함수 종속`이라고 한다 이것을 제거해야한다.

저자 : 책 = 1 : n 의 관계를 가진다.

**[ 도서테이블 ]**
| 책 제목 | 가격 | 저자 |
|---|---|---|
| 노드 교과서 | 10000 | 신범철 |
| 쉽게 배우는 운영제체 | 15000 | 신범철 |
| 데이터 베이스 | 20000 | 김용기 |


**[ 저자테이블 ]**
| 저자 | 저자 자기소개 | 저자 성별 |
|---|---|---|
| 신범철 | hello | 남자 |
| 신범철 | hello | 남자 |
| 김용기 | bye | 남자 |

