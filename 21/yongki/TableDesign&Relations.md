# 테이블 설계와 릴레이션

- [테이블 설계와 릴레이션](#테이블-설계와-릴레이션)
  - [데이터 모델링 기술의 중요성](#데이터-모델링-기술의-중요성)
  - [정규화 수행과정](#정규화-수행과정)
    - [1차 정규화](#1차-정규화)
    - [2차 정규화](#2차-정규화)
    - [3차 정규화](#3차-정규화)
    - [보이스-코드 정규화](#보이스-코드-정규화)
    - [맺음말](#맺음말)
  - [참고 문헌](#참고-문헌)

## 데이터 모델링 기술의 중요성

복잡한 정보를 관리하고 싶은 경우가 존재하는데,

    cf. - 상품을 판매하고, 고객 지원을 실시하는 경우

        - 문의를 해온 고객이 블랙 리스트 인물인 경우

테이블은 반드시 정해진 포맷이 있는 것이 아니다.

    애플리케이션은 사용자를 위해서 있는 것이고, 
    
    그 사용자의 요구에 따라 테이블은 어떻게든 달라진다.

때문에, 데이터 모델링은

    필요한 데이터 항목을 나열하고 테이블 설계에 도입해 나가는 작업을 말한다.

이는 데이터 일관성을 유지시켜준다.

일관성이 무너진 상황에서 개선사항을 확인할 것이다.

## 정규화 수행과정

정규화는

    데이터 처리 연산시 각종 이상현상이 발생하는 테이블을 데이터 모델링하는 행위다.

이상현상에는

    +----------+--------+--------+------------+
    | 학번(pk) |  이름  | 학과명 | 학과사무실 |
    +==========+========+========+============+
    |   1111   | 김용기 |  컴소  |   복음관   |
    +----------+--------+--------+------------+
    |   2222   | 김지용 |  컴소  |   복음관   |
    +----------+--------+--------+------------+
    |   3333   | 신범철 |  컴소  |   복음관   |
    +----------+--------+--------+------------+
    |   4444   | 아무개 |  사복  |   일립관   |     ←
    +----------+--------+--------+------------+


    - 삽입 이상: 원하지 않는 정보까지 함께 삽입해야만 하는 현상

                  cf. 사복의 학과 정보만 넣으려는데, 학생 정보도 넣어야한다.

    - 삭제 이상: 필요한 정보까지 함께 삭제되어야 하는 현상

                  cf. 학번 4444를 삭제하는 경우, 아무개가 사복의 유일한 학생이라면,
                      유지하고 싶은 학과 정보도 같이 사라진다.

    - 수정 이상: 동일한 내용을 여러 건의 데이터에서 반복 수정해야하는 현상

                  cf. 컴소의 학과사무실이 수정된다면, 컴소에 소속된 학생의 수만큼 수정 연산이 수행된다.

### 1차 정규화

    테이블 구성에서 중복/반복/복합값을 제거한다.

    - 중복한 열 값의 일부를 수정하면 그것을 감지할 수 없고,

    - 반복값은 

    - 복합값은 애플리케이션에서 순차 처리와 같은 작업을 요구하기 때문이다.

<table>
  <tr>
    <th>정규화 이전</th>
    <th>1차 정규화</th>
  </tr>
  <tr>
    <td>
<p>

    +----------+--------+------------------------------+
    | 학번(pk) |  이름  |            과목명            |
    +==========+========+==============================+
    |   1111   | 김용기 |    데이터베이스, 운영체제    |
    +----------+--------+------------------------------+
    |   2222   | 김지용 | 운영체제, 네트워크, 자료구조 |
    +----------+--------+------------------------------+
    |   3333   | 신범철 |           자료구조           |
    +----------+--------+------------------------------+
</p>
    </td>
    <td>
<p>

    +---------+------+--------+--------------+
    | _id(pk) | 학번 |  이름  |    과목명    |
    +=========+======+========+==============+
    |    1    | 1111 | 김용기 | 데이터베이스 |
    +---------+------+--------+--------------+
    |    2    | 1111 | 김용기 |   운영체제   |
    +---------+------+--------+--------------+
    |    3    | 2222 | 김지용 |   운영체제   |
    +---------+------+--------+--------------+
    |    4    | 2222 | 김지용 |   네트워크   |
    +---------+------+--------+--------------+
    |    5    | 2222 | 김지용 |   자료구조   |
    +---------+------+--------+--------------+
    |    6    | 3333 | 신범철 |   자료구조   |
    +---------+------+--------+--------------+
</p>
    </td>
  </tr>
</table>

### 2차 정규화

    pk에 의존하지 않는 열을 분리한다.

여기서 의존한다는 의미는 고유성이 없기 때문에 의존을 한다는 의미다.

인적 테이블에 `과목 코드`와 `학점`이 추가되었다.

<table>
  <tr>
    <th>정규화 이전</th>
    <th colspan="2">2차 정규화</th>
  </tr>
  <tr>
    <td align="center">인적 테이블 + a</td>
    <td align="center">인적 테이블</td>
    <td align="center">과목 테이블</td>
  </tr>
  <tr>
    <td>
<p>

    +---------+------+--------+----------+--------------+------+
    | _id(pk) | 학번 |  이름  | 과목코드 |    과목명    | 학점 |
    +=========+======+========+==========+==============+======+
    |    1    | 1111 | 김용기 |    D11   | 데이터베이스 |   B  |
    +---------+------+--------+----------+--------------+------+
    |    2    | 1111 | 김용기 |    O22   |   운영체제   |   A  |
    +---------+------+--------+----------+--------------+------+
    |    3    | 2222 | 김지용 |    O22   |   운영체제   |   B  |
    +---------+------+--------+----------+--------------+------+
    |    4    | 2222 | 김지용 |    N33   |   네트워크   |   A  |
    +---------+------+--------+----------+--------------+------+
    |    5    | 2222 | 김지용 |    N44   |   자료구조   |   A  |
    +---------+------+--------+----------+--------------+------+
    |    6    | 3333 | 신범철 |    N44   |   자료구조   |   A  |
    +---------+------+--------+----------+--------------+------+

</p>
    </td>
    <td>
<p>

    +---------+------+--------+--------------+------+
    | _id(pk) | 학번 |  이름  | 과목코드(fk) | 학점 |
    +=========+======+========+==============+======+
    |    1    | 1111 | 김용기 |      D11     |   B  |
    +---------+------+--------+--------------+------+
    |    2    | 1111 | 김용기 |      O22     |   A  |
    +---------+------+--------+--------------+------+
    |    3    | 2222 | 김지용 |      O22     |   B  |
    +---------+------+--------+--------------+------+
    |    4    | 2222 | 김지용 |      N33     |   A  |
    +---------+------+--------+--------------+------+
    |    5    | 2222 | 김지용 |      N44     |   A  |
    +---------+------+--------+--------------+------+
    |    6    | 3333 | 신범철 |      N44     |   A  |
    +---------+------+--------+--------------+------+
</p>
    </td>
    <td>
<p>

    +--------------+--------------+
    | 과목코드(pk) |    과목명    |
    +==============+==============+
    |      D11     | 데이터베이스 |
    +--------------+--------------+
    |      O22     |   운영체제   |
    +--------------+--------------+
    |      N33     |   네트워크   |
    +--------------+--------------+
    |      N44     |   자료구조   |
    +--------------+--------------+
</p>
    </td>
  </tr>
</table>

### 3차 정규화

    pk에 의존하지 않지만 그 밖에 다른 열에 의존하는 열을 분리한다.

    > 🤔 2차 정규화 예시에도 적용된다.

인적정보 테이블에 `강의실` 정보가 추가되었다.

<table>
  <tr>
    <th>정규화 이전</th>
    <th colspan="2">3차 정규화</th>
  </tr>
    <tr>
    <td align="center">인적 테이블 + a</td>
    <td align="center">인적 테이블</td>
    <td align="center">강의실 테이블</td>
  </tr>
  <tr>
    <td>
<p>

    +---------+------+--------+--------------+------+--------+
    | _id(pk) | 학번 |  이름  | 과목코드(fk) | 학점 | 강의실 |
    +=========+======+========+==============+======+========+
    |    1    | 1111 | 김용기 |      D11     |   B  |   301  |
    +---------+------+--------+--------------+------+--------+
    |    2    | 1111 | 김용기 |      O22     |   A  |   302  |
    +---------+------+--------+--------------+------+--------+
    |    3    | 2222 | 김지용 |      O22     |   B  |   302  |
    +---------+------+--------+--------------+------+--------+
    |    4    | 2222 | 김지용 |      N33     |   A  |   303  |
    +---------+------+--------+--------------+------+--------+
    |    5    | 2222 | 김지용 |      N44     |   A  |   305  |
    +---------+------+--------+--------------+------+--------+
    |    6    | 3333 | 신범철 |      N44     |   A  |   305  |
    +---------+------+--------+--------------+------+--------+
</p>
    </td>
    <td>
<p>

    +---------+------+--------+--------------+------+
    | _id(pk) | 학번 |  이름  | 과목코드(fk) | 학점 |
    +=========+======+========+==============+======+
    |    1    | 1111 | 김용기 |      D11     |   B  |
    +---------+------+--------+--------------+------+
    |    2    | 1111 | 김용기 |      O22     |   A  |
    +---------+------+--------+--------------+------+
    |    3    | 2222 | 김지용 |      O22     |   B  |
    +---------+------+--------+--------------+------+
    |    4    | 2222 | 김지용 |      N33     |   A  |
    +---------+------+--------+--------------+------+
    |    5    | 2222 | 김지용 |      N44     |   A  |
    +---------+------+--------+--------------+------+
    |    6    | 3333 | 신범철 |      N44     |   A  |
    +---------+------+--------+--------------+------+
</p>
    </td>
    <td>
<p>

    +--------------+--------+
    | 과목코드(pk) | 강의실 |
    +==============+========+
    |      D11     |   301  |
    +--------------+--------+
    |      O22     |   302  |
    +--------------+--------+
    |      N33     |   303  |
    +--------------+--------+
    |      N44     |   305  |
    +--------------+--------+
</p>
    </td>
  </tr>
</table>

### 보이스-코드 정규화

    A열을 각 다르게 의존하는 B, C열을 분리한다.

정규화한 과목 테이블에 `교수`와 `교재명`이 추가되었다.

과목 테이블에 `과목 코드`는 더이상 pk로써 고유하지 않다.

과목코드는 교재명을 의존하며, 

    cf. O22 과목에서는 Book2, Book3를 사용한다.

교수는 교재명을 다르게 의존한다.

    cf. P2가 사용하는 교재는 Book2, Book3, Book4이다.

<table>
  <tr>
    <th>정규화 이전</th>
    <th colspan="2">보이스-코드 정규화</th>
  </tr>
    <tr>
    <td align="center">과목 테이블 + a</td>
    <td align="center">과목 테이블</td>
    <td align="center">교수 테이블</td>
  </tr>
  <tr>
    <td>
<p>

    +---------+----------+--------------+------+--------+
    | _id(pk) | 과목코드 |    과목명    | 교수 | 교재명 |
    +---------+----------+--------------+------+--------+
    |    1    |    D11   | 데이터베이스 |  P1  |  Book1 |
    +---------+----------+--------------+------+--------+
    |    2    |    O22   |   운영체제   |  P2  |  Book2 |
    +---------+----------+--------------+------+--------+
    |    3    |    O22   |   운영체제   |  P2  |  Book3 |
    +---------+----------+--------------+------+--------+
    |    4    |    N33   |   네트워크   |  P2  |  Book4 |
    +---------+----------+--------------+------+--------+
    |    5    |    N44   |   자료구조   |  P1  |  Book5 |
    +---------+----------+--------------+------+--------+
</p>
    </td>
    <td>
<p>

    +------------+--------------+----------+
    | 교재명(pk) |    과목명    | 과목코드 |
    +============+==============+==========+
    |    Book1   | 데이터베이스 |    D11   |
    +------------+--------------+----------+
    |    Book2   |   운영체제   |    O22   |
    +------------+--------------+----------+
    |    Book3   |   운영체제   |    O22   |
    +------------+--------------+----------+
    |    Book4   |   네트워크   |    N33   |
    +------------+--------------+----------+
    |    Book5   |   자료구조   |    N44   |
    +------------+--------------+----------+
</p>
    </td>
    <td>
<p>

    +------------+------+
    | 교재명(pk) | 교수 |
    +============+======+
    |    Book1   |  P1  |
    +------------+------+
    |    Book2   |  P2  |
    +------------+------+
    |    Book3   |  P2  |
    +------------+------+
    |    Book4   |  P2  |
    +------------+------+
    |    Book5   |  P1  |
    +------------+------+
</p>
    </td>
  </tr>
</table>

<hr/>

### 맺음말

<dl><dt>
관계형을 많이 사용해보지 못하고, depth가 큰 데이터를 다루기 위해 NoSQL 위주로만 사용해본 바로써

앞으로 발생할 일관성 측면에서 관계형의 활용은 중요하다고 생각되며,

이를 위한 테이블 설계는 

교재에서 말한 바와 같이 <u>익숙해질수 밖에 없다.</u>
</dt></dt>

<hr/>

## 참고 문헌

[정규화 수행과정](https://www.topcit.or.kr/upload/edubox/essence/ess_ko_02/index.html) ━ *TOPCIT*
