# 테이블 설계와 릴레이션

- [테이블 설계와 릴레이션](#테이블-설계와-릴레이션)
  - [데이터 모델링 기술의 중요성](#데이터-모델링-기술의-중요성)
  - [정규화 수행과정](#정규화-수행과정)
    - [1차 정규화](#1차-정규화)
    - [2차 정규화](#2차-정규화)
    - [3차 정규화](#3차-정규화)
    - [보이스-코드 정규화](#보이스-코드-정규화)
    - [맺음말](#맺음말)
  - [참고 문헌](#참고-문헌)

## 데이터 모델링 기술의 중요성

데이터 모델링이란

```
필요한 데이터 항목을 나열하고 테이블 설계에 도입 해나가는 작업을 말한다.
```

복잡한 정보를 관리하고 싶은 경우가 존재하는데, 테이블은 반드시 정해진 포맷이 있는 것이 아니다.

```
cf. 복잡한 정보란,
    - 상품을 판매하고, 고객 지원을 실시하는 경우
    - 문의를 해온 고객이 블랙 리스트 인물인 경우
```

애플리케이션은 사용자를 위해서 있는 것이고, 그 사용자의 요구에 따라 테이블은 어떻게든 달라진다.

때문에, 데이터 모델링은 필연적이며, 데이터 모델링과 더불어 데이터 일관성(Consistency) 유지를 위한 지속적인 체크가 필요할 것이다.

## 정규화 수행과정

정규화란

```
데이터 처리 연산 시, 각종 이상현상이 발생하는 테이블을 데이터 모델링하는 행위다.
```

다음과 같은 상황에서 이상현상을 알아보겠다.

```
+----------+--------+--------+------------+-----+
| 학번(pk) |  이름  | 학과명 | 학과사무실 |     |
+==========+========+========+============+=====+
| 1111     | 김용기 | 컴소   | 복음관     |     |
+----------+--------+--------+------------+-----+
| 2222     | 김지용 | 컴소   | 복음관     |     |
+----------+--------+--------+------------+-----+
| 3333     | 신범철 | 컴소   | 복음관     |     |
+----------+--------+--------+------------+-----+
| 4444     | 아무개 | 사복   | 일립관     |     |
+----------+--------+--------+------------+-----+
```

이상현상에는 3가지 종류가 발생할 수 있다.

```
- 삽입 이상: 원하지 않는 정보까지 함께 삽입해야만 하는 현상
             cf. 사복의 학과 정보만 넣으려는데, 학생 정보도 넣어야한다.

- 삭제 이상: 필요한 정보까지 함께 삭제되어야 하는 현상
             cf. 학번 4444를 삭제하는 경우, 아무개가 사복의 유일한 학생이라면,
                 유지하고 싶은 학과 정보도 같이 사라진다.

- 수정 이상: 동일한 내용을 여러 건의 데이터에서 반복 수정해야하는 현상
             cf. 컴소의 학과사무실이 수정된다면, 컴소에 소속된 학생의 수만큼 수정 연산이 수행된다.
```

### 1차 정규화

```
1차 정규화를 통해, (중복, 반복, 복합값)을 제거한다.
```

<table>
  <tr>
    <th>정규화 이전</th>
    <th>1차 정규화</th>
  </tr>
  <tr>
    <td>
<p>

```
+----------+--------+------------------------------+
| 학번(pk) |  이름  |            과목명            |
+==========+========+==============================+
| 1111     | 김용기 | 데이터베이스, 운영체제       |
+----------+--------+------------------------------+
| 2222     | 김지용 | 운영체제, 네트워크, 자료구조 |
+----------+--------+------------------------------+
| 3333     | 신범철 | 자료구조                     |
+----------+--------+------------------------------+
```
</p>
    </td>
    <td>
<p>

```
+------+----------+--------------+
| 학번 | 이름(pk) |  과목명(pk)  |
+======+==========+==============+
| 1111 | 김용기   | 데이터베이스 |
+------+----------+--------------+
| 1111 | 김용기   | 운영체제     |
+------+----------+--------------+
| 2222 | 김지용   | 운영체제     |
+------+----------+--------------+
| 2222 | 김지용   | 네트워크     |
+------+----------+--------------+
| 2222 | 김지용   | 자료구조     |
+------+----------+--------------+
| 3333 | 신범철   | 자료구조     |
+------+----------+--------------+
```
</p>
    </td>
  </tr>
</table>

### 2차 정규화

```
2차 정규화를 통해, pk에 의존하는 열을 분리한다.

cf. 과목명은 복합 식별자인 (학번, 과목코드) 중 과목코드에 의존한다.
```

<table>
  <tr>
    <th>정규화 이전</th>
    <th colspan="2">2차 정규화</th>
  </tr>  
  <tr>
    <td>
<p>

```
+----------+--------+--------------+--------------+------+
| 학번(pk) |  이름  | 과목코드(pk) |    과목명    | 학점 |
+==========+========+==============+==============+======+
| 1111     | 김용기 | D11          | 데이터베이스 | B    |
+----------+--------+--------------+--------------+------+
| 1111     | 김용기 | O22          | 운영체제     | A    |
+----------+--------+--------------+--------------+------+
| 2222     | 김지용 | O22          | 운영체제     | B    |
+----------+--------+--------------+--------------+------+
| 2222     | 김지용 | N33          | 네트워크     | A    |
+----------+--------+--------------+--------------+------+
| 2222     | 김지용 | N44          | 자료구조     | A    |
+----------+--------+--------------+--------------+------+
| 3333     | 신범철 | N44          | 자료구조     | A    |
+----------+--------+--------------+--------------+------+
```
</p>
    </td>
    <td>
<p>

```
+----------+--------+--------------+------+
| 학번(pk) |  이름  | 과목코드(pk) | 학점 |
+==========+========+==============+======+
| 1111     | 김용기 | D11          | B    |
+----------+--------+--------------+------+
| 1111     | 김용기 | O22          | A    |
+----------+--------+--------------+------+
| 2222     | 김지용 | O22          | B    |
+----------+--------+--------------+------+
| 2222     | 김지용 | N33          | A    |
+----------+--------+--------------+------+
| 2222     | 김지용 | N44          | A    |
+----------+--------+--------------+------+
| 3333     | 신범철 | N44          | A    |
+----------+--------+--------------+------+
```
</p>
    </td>
    <td>
<p>

```
+--------------+--------------+
| 과목코드(pk) |    과목명    |
+==============+==============+
| D11          | 데이터베이스 |
+--------------+--------------+
| O22          | 운영체제     |
+--------------+--------------+
| N33          | 네트워크     |
+--------------+--------------+
| N44          | 자료구조     |
+--------------+--------------+
```
</p>
    </td>
  </tr>
</table>

### 3차 정규화

```
3차 정규화를 통해, pk에 의존하지 않지만 그 밖에 다른 열에 의존하는 열을 분리한다.

cf. 학과사무실은 학과에 의존하며, 학과는 학번에 의존한다.
    학과사무실과 학과를 분리한다.
```

<table>
  <tr>
    <th>정규화 이전</th>
    <th colspan="2">3차 정규화</th>
  </tr>    
  <tr>
    <td>
<p>

```
+----------+--------+----------------------+------------+
| 학번(pk) |  이름  |         학과         | 학과사무실 |
+==========+========+======================+============+
| 1111     | 김용기 | 컴퓨터소프트웨어학과 | 복음관     |
+----------+--------+----------------------+------------+
| 2222     | 김지용 | 컴퓨터소프트웨어학과 | 복음관     |
+----------+--------+----------------------+------------+
| 3333     | 신범철 | 컴퓨터소프트웨어학과 | 복음관     |
+----------+--------+----------------------+------------+
```
</p>
    </td>
    <td>
<p>

```
+----------+--------+----------------------+
| 학번(pk) |  이름  |         학과         |
+==========+========+======================+
| 1111     | 김용기 | 컴퓨터소프트웨어학과 |
+----------+--------+----------------------+
| 2222     | 김지용 | 컴퓨터소프트웨어학과 |
+----------+--------+----------------------+
| 3333     | 신범철 | 컴퓨터소프트웨어학과 |
+----------+--------+----------------------+
```
</p>
    </td>
    <td>
<p>

```
+----------------------+------------+
|       학과(pk)       | 학과사무실 |
+======================+============+
| 컴퓨터소프트웨어학과 | 복음관     |
+----------------------+------------+
```
</p>
    </td>
  </tr>
</table>

### 보이스-코드 정규화

```
A열을 다르게 의존하는 B, C열을 분리한다.

cf. 교재명은 복합 식별자인 (교수, 과목명)에 의존한다.
    과목명은 교재명에 의존한다.
```

<table>
  <tr>
    <th>정규화 이전</th>
    <th colspan="2">보이스-코드 정규화</th>
  </tr>    
  <tr>
    <td>
<p>

```
+----------+------------+-------+
| 교수(pk) | 과목명(pk) | 교재  |
+----------+------------+-------+
| P1       | 자료구조   | Book1 |
+----------+------------+-------+
| P1       | 네트워크   | Book2 |
+----------+------------+-------+
| P2       | 네트워크   | Book3 |
+----------+------------+-------+
| P2       | 운영체제   | Book4 |
+----------+------------+-------+
| P3       | 운영체제   | Book4 |
+----------+------------+-------+
```
</p>
    </td>
    <td>
<p>


```
+----------+------------+
| 교수(pk) | 교재명(pk) |
+==========+============+
| P1       | Book1      |
+----------+------------+
| P1       | Book2      |
+----------+------------+
| P2       | Book3      |
+----------+------------+
| P2       | Book4      |
+----------+------------+
| P3       | Book4      |
+----------+------------+
```
</p>
    </td>
    <td>
<p>

```
+----------------+----------+
| 교재명(pk, fk) |  과목명  |
+================+==========+
| Book1          | 자료구조 |
+----------------+----------+
| Book2          | 네트워크 |
+----------------+----------+
| Book3          | 네트워크 |
+----------------+----------+
| Book4          | 운영체제 |
+----------------+----------+
```
</p>
    </td>
  </tr>
</table>

<hr/>

### 맺음말

앞으로 발생할 일관성 측면에서 관계형의 활용은 중요하다고 생각된다.

프로젝트에서 NoSQL을 사용중인데, 사용중인 이유가 단지 depth가 큰 데이터를 다루기 위함이다.

NoSQL도 관계형이지만, SQL의 join 처럼 DB 엔진에 포함된게 아니라 mongoose와 같은 ORM에서 처리하여, 앱서버의 자원을 먹는다고 한다.

따라서, 일관성이 요구되는 테이블은 SQL,

일관성이 크게 요구되지 않으면서 depth가 큰 데이터를 가진 테이블은 NoSQL과 같이

다양하게 사용해보면서 테이블 설계에 익숙해져야한다고 판단한다.

<hr/>

## 참고 문헌

[정규화 수행과정](https://www.topcit.or.kr/upload/edubox/essence/ess_ko_02/index.html) ━ *TOPCIT*
