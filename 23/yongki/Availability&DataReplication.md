# 가용성과 데이터의 복제

## 복제

2대 이상의 서버가 동일한 데이터를 담도록 실시간으로 동기화하는 기술이다.

    - 성능을 희생하여 데이터를 무결성을 증시하는 유형과

    - 데이터 소실의 리스크를 수용하며 성능을 추구하는 유형이 있다.

### 단방향 복제

마스터 서버는

    갱신 SQL문을 처리하는 서버이다.

슬레이브 서버는

    검색 SQL문을 처리하는 서버이다.

단방향/비동기 복제는

    a. 마스터에서 갱신 SQL문이 로그 파일(바이너리 로그)에 기록된다.
    
    b. 로그 파일의 내용이 슬레이브로 복사된다. 
    
      (슬레이브의 I/O 스레드에 의한 바이너리 로그 수신)
    
    c. 슬레이브는 저장된 로그 파일을 순차적으로 실행함으로써 
      
      (슬레이브의 SQL 스레드에 의한 바이너리 로그 실행)
    
    마스터와 슬레이브의 상태가 일치되는 구조이다. 

바이너리 로그 수신과 로그 실행은 모두 비동기로 전파된다.

전자는 

    🤔 거의 동기에 가까운 속도로 진행되지만

후자는 

    거대한 테이블을 갱신하는 경우 
    
    디스크가 병목현상을 일으키면 처리가 늦어지는 경향이 있어 

    비동기와 같이 처리 시점의 이원화가 필요한 곳이다.

복제시 주의사항에는

    - 슬레이브는 하나의 마스터만 설정 가능하다.
    - 마스터-슬레이브 간의 데이터 동기화를 위해 슬레이브는 읽기 전용으로 설정한다.
    - 복제가 불필요한 경우 바이너리 로그를 중지한다.

마스터가 장애를 일으킨 경우 슬레이브에서는 지금까지의 업데이트 결과가 반영되지 않을 수 있다.

1. 마스터에서 생성한 바이너리 로그가 슬레이브에서는 마지막까지 수신되지 않은 상황

    즉, 슬레이브가 수신한 최종 결과와 마스터의 최종 결과 사이의 데이터가 손실된 상황이다.

2. 슬레이브에서의 바이너리 로그의 실행이 마지막까지 종료되지 않은 상황

    🤔 즉, 슬레이브의 SQL 스레드가 지연되었기 때문에 일어나는 상황이다.