# 3. Transports Layer

## 트랜스포트 계층 서비스 및 개요

- 트랜스포트 계층 프로토콜은 서로 다른 호스트에서 동작하는 애플리케이션 프로세스들 간 논리적 통신을 제공
- 트랜스포트 계층 프로토콜은 네워크 라우터가 아닌 종단 시스템에서 구현된다.
    1. 송신측 애플리케이션 프로세스로부터 데이터를 받는다
    2. 송신측으로 부터 받은 데이터 분할하여 각각의 데이터에 트랜스포트 계층 헤더를 추가한다
    3. 트랜스 포트 계층은 만들어진 세그먼트를 수신처로 전송하기 위해 네트워크 계층으로 세그멘트를 전달한다.
- 네트워크 애플리케이션에는 하나 이상 트랜스포트 계층 프로토콜이 사용 가능하다.

<br>

## 인터넷 트랜스 포트 계층의 개요

**Transports Layer protocol**

- 애플리케이션에게 비신뢰적이기 비연결형인 서비스 제공 UDP
- 애플리케이션에게 신뢰적이고 연결지향형 서비스를 제공하는 TCP

**Network Layer Protocol**

- 호스트들 간 논리적 통신을 제공하는 최선형 전달 서비스인 IP
- 비신뢰적인 서비스
    - IP는 세그먼트의 전달을 보장하지 않는다
    - 세그먼트 전달의 순서를 보장하지 않는다.

**Transports Layer protocol의 기능**

- 종단 시스템 사이의 IP 전달 서비스를 종단시스템에서 동작하는 두프로세스 간의 전달 서비스로 확장하는 것
    - host - host 간 데이터 전달에서 ⇒ process - process 간 데이터 전달 로 확장
        - 트랜스포트 다중화
        - 트랜스포트 역다중화
        
<br>

## 다중화와 역다중화

애플리케이션의 한 부분으로 프로세스 별 소켓을 가지고 있음

⇒ 프로세스로 도착하는 데이터를 실제 프로세스에게 전달하는 것이 아님

⇒ 중간 매개자인 소켓을 통해 데이터가 전달됨

- **다중화**
    - 출발지 호스트에서 전달할 데이터를 모은다
    - 전달할 데이터에 대한 세그먼트를 생성하기 위해 데이터의 헤더 정보로 캡슐화 한다.
    - 완성된 세그먼트들을 네트워크 계층으로 전달한다.
    
    ⇒ 다중화 : 트렌스 포트 계층 에서 전달하기 위해 구성한 세그먼트들을 네트워크 계층으로 전달하는 작업
    
- **역다중화**
    - 수신측의 트랜스포트 계층은 수신 소켓을 식별하기위해 필드를 검사
    - 수신측의 네트워크 계층으로 받은 세그먼트를 식별된 소켓으로 전달
    
    ⇒ 역다중화 : 트랜스 포트 계층 세그먼트의 데이터를 올바른 소켓으로 전달하는 작업
    

### 비연결형 트랜스포트 : UDP

- 최소한의 동작 수행
    - 트랜스 포트 계층과 네트워크 계층 간에 데이터의 송수신을 위해
        - 다중화 서비스 제공
        - 역다중화 서비스 제공
- 간단한 오류 검사 기능
    - UDP 체크섬

>⇒ 위의 기능 제외 IP에 아무것도 추가하지 않는다 ... 즉 거의 IP와 직접 통신하는 셈

**특징**

- 무슨 데이터를 언제 보낼지에 대해 애플리케이션 레벨에서 더 정교한 제어가가 필요
- 연결설정이 없다
- 연결 상태가 없다
- TCP는 20 바이트 헤더를 갖는 것에 비해 UDP의 헤더는 8 바이트 오버헤드만 갖는다.

<br>


### UDP의 다중화

1. 애플리케이션 프로세스로부터 데이터를 가져온다
2. 다중화/역다중화 서비스에 대한 출발지 포트번호, 목적지 포트 번호 필드를 첨부
3. 최종 세그먼트를 네트워크 계층으로 넘겨주거나 세그먼트를 받는다.

- 네트워크 계층은 트랜스포트 계층 세그먼트를 IP 데이터그램으로 캡슐화
- 세그먼트를 수신 호스트에게 최선형 전달 서비스로 전달

>⇒ 트랜스 포트 개체들 사이 핸드쉐이크를 사용하지 않는다!

>⇒ 이런 이유로 UDP를 비연결형 이라고 한다.

<br>

### 애플리케이션과 그 하위 트랜스포트 프로토콜

| 애플리케이션 | 애플리케이션 계층 프로토콜 | 하위 트랜스포트 프로토콜 |
| --- | --- | --- |
| 전자메일 | SMTP | TCP |
| 원격 터미널 접속 | TELNET | TCP |
| 웹 | HTTP | TCP |
| 파일 전송 | FTP | TCP |
| 원격파일 서버 | NFS | 일반적 UDP |
| 스트리밍 멀티미디어 | 통상 독점 프로토콜 | UDP 또는 TCP |
| 인터넷 폰 | 통상 독점 프로토콜 | UDP 또는 TCP |
| 네트워크 관리 | SNMP | 일반적 UDP |
| 이름 변환 | DNS | 일반적 UDP |

UDP를 사용하는 예시

- 네트워크 관리 애플리케이션
    
    ⇒ 네트워크 관리는 네트워크가 혼잡한 상태에 있을 때 자주 동작해야 하므로 UDP가 더 좋다
    
    ex) DNS
    

<br>

### UDP 세그먼트 구조

| 출발지 포트 번호 | 목적지 포트 번호 |
| --- | --- |
| 길이 | 체크섬 |
| 애플리케이션 데이터 |

>⇒ 32 비트

<br>

- UDP 헤더는 2바이트씩 구성된 4개의 필드를 가진다.
    - 출발지 포트번호
    - 목적지 포트번호
        
        ⇒ UDP의 소켓은 출발지와 목적지 포트번호 2가지로 소켓을 구분
        
    - 길이
        
        ⇒ 데이터의 길이
        
    - 체크섬
        
        ⇒ 오류 체크
        

<br>

### 체크섬

UDP 체크섬은 오류 검출을 제공

>⇒ 세그먼트가 출발지로부터 목적지로 이동시 UDP 세그먼트 안 비트에 대한 변경사항이 있는지 검사하는 것

- 과정
    - 세그먼트 안에 있는 모든 16비트 워드 단위로 더함
    - 1의 보수를 수행
        
        ⇒ 덧셈 과정에서 발생하는 오버플로우는 “윤회식 자리올림” 한다
        
    - 완성된 비트와 체크섬 데이터와 비교하여 변경사항이 있는지 검사
    
    <br>
    
- UDP가 체크섬을 제공하는 이유
    - “출발지와 목적지 사이 모든 링크가가 오류 검사를 제공한다” 라는 보장이 없기 때문
        
        ⇒ 하지만 오류를 검출하고 오류가 있을시 패킷을 버리는 행위만 한다
        
        ⇒ UDP는 오류 검사만 제공하며 오류를 회복하기위한 어떠한 일도 하지 않는다.