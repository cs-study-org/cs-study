# Chapter3

이제 실제 패킷이 전기신호로 변환되어 거쳐가는 과정을 알아보자

## <전체 구성도>

![스크린샷 2022-03-24 오후 7.42.58.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e37211d0-1c5e-4358-bdba-3e99a58ed7cb/스크린샷_2022-03-24_오후_7.42.58.png)

## 01) Hub

![스크린샷 2022-03-24 오후 7.43.49.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6ec02eb5-bfb9-4d31-95b6-320ebbd53a49/스크린샷_2022-03-24_오후_7.43.49.png)

- 패킷 하나하나가 독립적으로 신호로 변경되어 전송된다
    - 패킷 내부의 데이터나 TCP 프로토콜 제어 정보등은 패킷의 운반에는 영향을 미치지 않는다.
- 전송은 PHY회로에서 RJ45를 통해 트위스트 페어 케이블로 송출된다.
- 렌 케이블이 꼬와져 있으므로 잡음을 방지하여 신호를 유지한다.
    - 트위스트 페어 케이블을 통해 신호의 잡음을 방지하여 외부 영향을 통한 변질을 방지한다.
- 신호가 리피터 허브로 도착하면 연결된 모든 케이블에 신호를 뿌린다.
    - 패킷의 수신측 MAC 주소에 해당하는 기기만 패킷을 받는다는 원리를 통해 수신측 방향으로 신호를 뿌린다.
    

## 02) Switching Hub

![스크린샷 2022-03-24 오후 7.44.50.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f867d8b4-8b5c-4239-9d9e-99ad07477f62/스크린샷_2022-03-24_오후_7.44.50.png)

- 신호가 스위칭 허브로 들어오면 패킷으로 다시 구성하여 주소 테이블을 통해 신호를 중계한다.
    - 주소 테이블은 스위칭 허브에 RJ45를 꽂을수 있는 포트 별 MAC주소표로 중계를 진행한다.
- 스위칭 허브의 MAC주소 테이블은 등록 과 갱신이 이루어진다.
    - 패킷의 송신 혹은 수신이 이루어질때 마다 MAC주소를 포트별 주소 등록하거나 갱신한다.
- 스위칭 허브의 예외 적인 동작 ( 송신 포트와 수신 포트가 동일할때, 수신 포트가 없을때, 브로드캐스트)
    - 송신 포트와 수신 포트가 동일할때
        - 스위칭 허브는 패킷을 수신포트와 송신 포트가 동일할 경우 중계하지 않고 폐기한다.
    - 수신 포트가 없을때
        - 수신측의 MAC 주소가 등록되어 있지 않거나 주소표에서 일정 시간이 지나 삭제되어 수신 포트가 없을경우
            
            ⇒ 패킷의 수신측 MAC 주소에 해당하는 기기만 패킷을 받는다는 원리를 통해 수신측 방향으로 브로드 캐스트로 전송한다.
            
    - 브로드 캐스트
        - 전송할 주소가 브로드캐스트 주소인 경우 송신하는 수신하는 포트 제외한 모든 포트에서 패킷을 송신한다.
- 전이중 모드에서 스위칭 허브의 충돌 방지 정책
    - 스위치의 전이중 모드는 송신용과 수신용 으로 신호선이 나누어져 있어 신호 충돌이 일어나지 않는다.
- 송신측 과 수신측 사이간 전송 속도와 동작 모드를 검출하여 자동 전환
    - 송신측과 수신측은 링크 펄스라는 펄스형 신호를 흘려 서로간 데이터 송수신 전송 속도와 동작모드를 서로 맞추어 상호작용한다.

## 03)Router

![스크린샷 2022-03-24 오후 8.23.40.png](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c2f16caa-5874-4327-ab4d-5b9d9fc387ad/스크린샷_2022-03-24_오후_8.23.40.png)

- 스위칭 허브를 경유한 패킷은 결국 라우터의 포트로 들어와 라우팅 테이블을 통해 다른 대역의 주소로 패킷을 중계한다.
- 라우팅 테이블은 IP주소로 중계 대상을 판단한다.
    - 스위칭 허브는 MAC 주소를통해 중계 대상을 조사하지만 라우터는 라우팅 테이블의 IP를 통해 중계 대상을 조사한다.
- 라우터의 포트는 MAC 주소와 IP 주소가 할당되어 있으며 자신에게 오는 패킷이 아닐경우 폐기하고 송신처에게 ICMP 메시지를 통해 이 사실을 통지한다.
    - 라우터의 PHY회로와 MAC회로에서 신호를 디지털 데이털 신호로 변환하여 자신에게 해당하는지 조사하여
        - 자신에게 올 경우 라우터의 메모리 버퍼에 저장
        - 자신에게 온 것이 아닐 경우 패킷을 폐기하고 ICMP 메시지를 통해 송신처에게 통보
- 라우터로 패킷이 들어올 경우 IP 헤더의 TTL 필드의 값을 줄이고 패킷을 전송하며 패킷이 네트워크상에서 TTL 값이 0 이 될경우 생존기간이 만료되어 폐기된다.
    - 라우터를 경유할때마다 패킷의 IP 헤더의 TTL이 갱신되며 TTL이 0이 될경우 폐기 되고 ICMP를 통해 송신처에게 통지한다.