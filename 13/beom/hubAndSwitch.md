# 케이블의 앞은 LAN기기였다.
# 허브와 스위치, 라우터의 탐험

## 목차
- 들어가며
- LAN 케이블
  - 트위스트 페어 케이블(꼰 선쌍)
- 스위칭 허브
  - 스위칭 허브 중계동작
  - MAC 주소표 갱신
- 리피터 허브 vs 스위칭 허브
- 라우터
  - 라우터 중계동작
- 라우터 부가기능
  - 주소변환
  - 주소변환 동작



## 들어가며
저번주차의 `이더넷의 기본`부분을 한번 읽고 온다면 이더넷과 `리피터허브`를 통한 이더넷 전송 방법 중 하나인 `반이중 모드`에 대해 이해할 수 있다.

이번 주차에서는 `스위칭 허브`를 통한 이더넷 전송 방법 중 하나인 `전이중 모드`부터 시작할 것이다.

이번 장의 큰 틀은

통신 상대까지 패킷을 전달하는 전체의 동작은 IP(라우터)가 담당하고, 이 동작을 할때 다음 라우터까지 패킷을 운반하는 부분은 이더넷(스위칭 허브)이 담당한다.



## LAN 케이블
> 일반적으로 랜선이라고도 부르는 LAN 케이블이 시작이다.

LAN 어댑터에서 허브로 이동하기 위해 케이블을 통과하는 사이에 신호는 약해진다.
- 신호가 약해지는 경우
  - 케이블 선이 길수록
  - 잡음이 심할 수록

### 트위스트 페어 케이블(꼰 선쌍)
잡음 방지 하기위해 선을 꼰 케이블

![잡음 방지 방법](asset/2.PNG)

- 주변 기기들로 인한 전자파(외부 잡음)
  - 선을 꼬음으로 외부의 전자파를 상쇄
- 같은 케이블 내 인접한 신호선의 의한 전자파(내부 잡음)
  - 꼬는 간격을 통해 전자파 상쇄


## 스위칭 허브
`전이중 방식`을 사용하여 이더넷 통신하는 기기 리피터 허브의 업그레이드 버전

> 전이중 방식 : 송신과 수신을 동시에 할 수 있는 방식


### 스위칭 허브 중계동작
1. 커넥터로 전류가 도착하면 PHY회로 수신 부분으로 이동
2. PHY(케이블에 맞는 전기 신호) -> MAC회로(공통 전기 신호)
3. MAC회로(공통 전기 신호) -> 버퍼 메모리(디지털 데이터)
4. FCS 검사 -> 버퍼 메모리
5. `MAC 주소표`의 MAC 주소와 수신처의 MAC주소가 일치하는 주소 검색
6. 해당 포트로 신호 전송
   - 이더넷의 규칙에 따라 아무도 수신중이지 않을경우에만 송신
   - 하지만 전이중 모드일 경우 수신중에도 송신 가능 


![스위치 허브 동작과정](asset/1.PNG)

### MAC 주소표 갱신
1. 패킷을 수신했을 때 송신처의 MAC 주소와 수신한 포트번호 갱신
2. 일정 시간이 경과하면 삭제

## 리피터 허브 vs 스위칭 허브
리피터 허브는 연결된 케이블 전부에 신호를 송신한다.

|  | 리피터 허브 | 스위칭 허브 |
|------|-------|---|
| 동작 모드 | 반이중 모드 | 전이중 모드 |
| 데이터 전송 | 모든 포트에 전달 | 특정 포트로만 전달 |
| 중계 동작 | 단일 | 복수 |


## 라우터
LAN을 연결시켜주는 장비로써 정보를 주고 받을 때 송신정보에 담긴 수신처의 주소를 읽고, 가장 적절한 통신경로를 이용하여 다른 통신망으로 전송하는 장치

### 라우터 중계동작
1. 허브, 스위치를 통해 신호를 수신
2. PHY(케이블에 맞는 전기 신호) -> MAC회로(공통 전기 신호)
3. MAC회로(공통 전기 신호) -> 버퍼 메모리(디지털 데이터)
4. FCS 검사 -> 버퍼 메모리
   - FCS 검사에서 MAC 주소가 자신의 주소에 해당하지 않을 경우 폐기
5. 패킷의 IP 주소와 `주소표`의 IP주소를 대조하여 중계 대상 판단
   - 해당하는 경로가 없을 경우 넷마스크 0.0.0.0인 기본 주소로 중계
6. 얻은 IP주소를 ARP를 통해 MAC헤더 부가
7. 중계 대상 포트로 패킷 이동
   - 이때 동작은 출력측 포트의 규칙을 따른다.
     - 이더넷이라면 이더넷의 규칙을, ADSL이라면 ADSL의 규칙을 따라 신호를 변환
8. 다음 라우터 사이의 네트워크를 통해 운반 의뢰
   - 이더넷이면 스위치허브
   - 무선 LAN이면 무선 LAN
   - 통신 회선이면 통신 회선

![라우터 동작과정](asset/0.PNG)


## 라우터의 부가 기능

### 주소변환
인터넷을 사용하는 사람들이 많아지면서 IP주소가 부족해지는 현상이 발생하였다.

이를 해결하기 위해 독립된 네트워크에서는 IP주소가 중복되어도 상관 없게 한것이다.

이렇게 되면 네트워크에서 고유의 주소를 할당할 필요없어져서 주소를 대폭 절약할 수 있다.

하지만 무지성으로 주소를 할당하면 문제가 일어날 수 있기 때문에 규칙을 정했다.

바로 무지성으로 주소할당을 받아도되는 `프라이비트 주소`와 고유한 주소인 `글로벌 주소`로 구분 지었다.

- 프라이비트 주소 범위
  - 10.0.0.0 ~ 10.255.255.255
  - 172.16.0.0 ~ 172.31.255.255
  - 192.168.0.0 ~ 192.168.255.255
- 왜 주소 범위인가?
  - 이 규칙을 정하는 시점에서 사용지않는 주소로 정한 것이다

내 노트북도 192.168.178.1이라는 프라이비트 주소안에 있다는 것을 알수 있다.

![내 노트북 ip확인](asset/ipconfig.PNG)


위 프라이비트 주소를 사용하므로 주소를 절약할 수 있다.

하지만 문제가 있다.

다른 네트워크로 보낼때 프라이비트 주소는 중복할 수 있다.

![사내 네트워크 구조](asset/3.PNG)

사진처럼 구성해서 해결가능하다.

고유한 글로벌 주소가 인터넷과 통신을 통해 다른 네트워크와 통신하고 하나의 글로벌 주소 안에서 프라이비트 주소를 사용해 여러 사람들이 사용한다.

즉, 사용자는 프라이비트 주소를 할당받아 사용하고 통신을 할 때는 라우터에서 주소변환을 통해 글로벌 주소로 통신한다.

### 주소변화의 동작
주소 변환의 구조는 패킷을 중계할 때 IP헤더에 기재된 **IP주소와 포트 번호**를 바꿔쓰는 것이다.


![ip주소 변환](asset/4.PNG)

요약하자면

데이터를 보내기 위해서는 사용하는 **네트워크 주소(글로벌 주소) + 라우터의 의해 프라이비트 주소 -> 글로벌 주소로 변화된 사용자 주소**가 필요하다.

